import csv
import re
from datetime import datetime

# Function to parse the communication field and extract required information
def parse_communication_field(communication):
    pattern = re.compile(r'Keyword\s.*?(approve|approved)', re.IGNORECASE)
    matches = pattern.findall(communication)
    if matches:
        date_matches = re.findall(r'\b\d{2}\.\d{2}\.\d{4}\b', communication)
        dates = [datetime.strptime(date, '%d.%m.%Y') for date in date_matches]
        latest_date = max(dates) if dates else None
        return matches[0], latest_date
    return None, None

# Function to process the CSV file
def process_csv(file_path):
    selected_columns = ['Title', 'Client Type', 'Communication', 'Destination / Url', 'Implementation Data', 'Source']
    results = []

    with open(file_path, mode='r', newline='', encoding='utf-8') as csvfile:
        reader = csv.DictReader(csvfile, delimiter=';')
        
        for row in reader:
            if all(col in row for col in selected_columns):
                communication = row['Communication']
                keyword_info, latest_date = parse_communication_field(communication)
                
                if keyword_info and latest_date:
                    result = {
                        'Title': row['Title'],
                        'Client Type': row['Client Type'],
                        'Communication': row['Communication'],
                        'Destination / Url': row['Destination / Url'],
                        'Implementation Data': row['Implementation Data'],
                        'Source': row['Source'],
                        'Latest Keyword Info': keyword_info,
                        'Latest Date': latest_date.strftime('%d.%m.%Y')
                    }
                    results.append(result)

    return results

# Path to your CSV file
file_path = 'path_to_your_file.csv'

# Process the file and get results
results = process_csv(file_path)

# Print the results in key-value pair format
for result in results:
    print(result)
